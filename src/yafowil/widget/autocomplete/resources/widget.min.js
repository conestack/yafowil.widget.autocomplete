!function(t,e){"use strict";class s{constructor(t,s,i){this.widget=t,this.elem=e("<div />").addClass("autocomplete-suggestion"),this.selected_elem=e("<strong />").text(i.substr(0,i.length)),this.rest_elem=e("<span />").text(s.substr(i.length,s.length)),this.value=s,this.elem.append(this.selected_elem).append(this.rest_elem),this.widget.dd_elem.append(this.elem),this.select=this.select.bind(this),this.elem.off("mousedown",this.select).on("mousedown",this.select)}select(){this.widget.input_elem.val(this.value),this.widget.hide_dropdown(),this.widget.input_elem.blur()}}class i{static initialize(t){e("div.yafowil-widget-autocomplete",t).each((function(){new i(e(this))}))}constructor(t){this.elem=t,this.elem.data("autocomplete",this),this.input_elem=e("input.autocomplete",this.elem).attr("spellcheck",!1).attr("autocomplete",!1),this.dd_elem=e("<div />").addClass("autocomplete-dropdown"),this.elem.append(this.dd_elem),this.suggestions=[],this.current_focus=0;let s=this.parse_options();this.sourcetype=s.type,this.delay=s.delay,this.min_length=s.minLength,this.parse_source(),this.input_handle=this.input_handle.bind(this),this.input_elem.off("input",this.input_handle).on("input",this.input_handle),this.hide_dropdown=this.hide_dropdown.bind(this),this.show_dropdown=this.show_dropdown.bind(this),this.input_elem.on("focusout",this.hide_dropdown).on("focus",this.show_dropdown),this.keydown_handle=this.keydown_handle.bind(this),this.input_elem.on("keydown",this.keydown_handle),this.autocomplete=this.autocomplete.bind(this)}unload(){clearTimeout(this.timeout),this.input_elem.off("input",this.input_handle).off("focusout",this.hide_dropdown).off("focus",this.show_dropdown).off("keydown",this.keydown_handle)}parse_options(){let t=e(".autocomplete-params",this.elem).text().split("|"),s=[];for(let e=0;e<t.length;e++){let i=t[e].split(","),o=i[1].replace(/^\s+|\s+$/g,"");isNaN(o)||(o=parseInt(o)),"True"===o&&(o=!0),"False"===o&&(o=!1),s[i[0].replace(/^\s+|\s+$/g,"")]=o}return s}parse_source(){let t=e(".autocomplete-source",this.elem).text();0===t.indexOf("javascript:")?(t=t.substring(11,t.length).split("."),this.source=window[t[0]][t[1]]):"local"===this.sourcetype?this.source=function(e,s){let i=t.split("|"),o=e.term,h=[];for(let t of i)t.substr(0,o.length).toUpperCase()===o.toUpperCase()&&h.push(t);s(h)}:"remote"===this.sourcetype&&(this.source=function(s,i){e.ajax({url:t,data:{term:s.term},dataType:"json",success:function(t){i(t)},error:function(){i([])}})})}input_handle(t){clearTimeout(this.timeout),this.dd_elem.empty().hide(),this.suggestions=[],this.current_focus=-1,this.input_elem.val().length>=this.min_length&&(this.timeout=setTimeout(this.autocomplete,this.delay))}autocomplete(){let t=this.input_elem.val();this.source({term:t},(e=>{for(let i of e)this.dd_elem.show(),this.suggestions.push(new s(this,i,t))}))}keydown_handle(t){"ArrowDown"===t.key?(this.current_focus++,this.add_active()):"ArrowUp"===t.key?(this.current_focus--,this.add_active()):"Enter"===t.key&&(t.preventDefault(),this.current_focus>-1&&this.suggestions[this.current_focus].select())}add_active(){if(0===this.suggestions.length)return;for(let t of this.suggestions)t.elem.removeClass("selected");this.current_focus>=this.suggestions.length?this.current_focus=0:this.current_focus<0&&(this.current_focus=this.suggestions.length-1);let t=this.suggestions[this.current_focus].elem;t.addClass("selected"),e("html,body").animate({scrollTop:t.offset().top})}hide_dropdown(){this.dd_elem.hide()}show_dropdown(){this.input_handle(),0!==this.suggestions.length&&this.dd_elem.show()}}e((function(){void 0!==window.ts?ts.ajax.register(i.initialize,!0):void 0!==window.bdajax?bdajax.register(i.initialize,!0):i.initialize()})),t.AutocompleteSuggestion=s,t.AutocompleteWidget=i,Object.defineProperty(t,"__esModule",{value:!0}),void 0===window.yafowil&&(window.yafowil={}),window.yafowil.autocomplete=t}({},jQuery);
//# sourceMappingURL=widget.min.js.map
