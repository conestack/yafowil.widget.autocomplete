!function(e,t){"use strict";class s{constructor(e,s,i){this.widget=e,this.elem=t("<div />").addClass("autocomplete-suggestion");let o=s.toUpperCase().indexOf(i.toUpperCase());this.start_elem=t("<span />").text(s.substring(0,o)),this.selected_elem=t("<strong />").text(s.substring(o,o+i.length)),this.end_elem=t("<span />").text(s.substring(o+i.length)),this.value=s,this.selected=!1,this.elem.append(this.start_elem).append(this.selected_elem).append(this.end_elem),this.widget.dd_elem.append(this.elem),this.select=this.select.bind(this),this.elem.off("mousedown",this.select).on("mousedown",this.select)}get selected(){return this._selected}set selected(e){!0===e?(this._selected=!0,this.elem.addClass("selected")):!1===e&&(this._selected=!1,this.elem.removeClass("selected"))}select(){this.selected=!0,this.widget.select_suggestion(this.value)}}class i{static initialize(e){t("div.yafowil-widget-autocomplete",e).each((function(){new i(t(this))}))}constructor(e){this.elem=e,this.elem.data("autocomplete",this),this.input_elem=t("input.autocomplete",this.elem).attr("spellcheck",!1).attr("autocomplete",!1),this.dd_elem=t("<div />").addClass("autocomplete-dropdown"),this.elem.append(this.dd_elem),this.suggestions=[],this.current_focus=0;let s=this.parse_options();this.sourcetype=s.type,this.delay=s.delay,this.min_length=s.minLength,this.parse_source(),this.on_input=this.on_input.bind(this),this.input_elem.off("input",this.on_input).on("input",this.on_input),this.hide_dropdown=this.hide_dropdown.bind(this),this.input_elem.on("focusout",this.hide_dropdown).on("focus",this.on_input),this.on_keydown=this.on_keydown.bind(this),this.input_elem.on("keydown",this.on_keydown),this.autocomplete=this.autocomplete.bind(this)}unload(){clearTimeout(this.timeout),this.input_elem.off("input",this.on_input).off("focusout",this.hide_dropdown).off("focus",this.on_input).off("keydown",this.on_keydown)}parse_options(){let e=t(".autocomplete-params",this.elem).text().split("|"),s=[];for(let t=0;t<e.length;t++){let i=e[t].split(","),o=i[1].replace(/^\s+|\s+$/g,"");isNaN(o)?"True"===o?o=!0:"False"===o&&(o=!1):o=parseInt(o),s[i[0].replace(/^\s+|\s+$/g,"")]=o}return s}parse_source(){let e=t(".autocomplete-source",this.elem).text();if(0===e.indexOf("javascript:")){let t=e.substring(11,e.length).split("."),s=window;for(let i of t)if(s=s[i],void 0===s)throw new Error("Cannot locate source function: "+e);this.source=function(e,t){s(e,t)}}else if("local"===this.sourcetype){if(""===e)throw new Error("Local source is empty");this.source=function(t,s){let i=e.split("|"),o=t.term,l=[];for(let e of i)e.toUpperCase().indexOf(o.toUpperCase())>-1&&l.push(e);s(l)}}else"remote"===this.sourcetype&&(this.source=function(s,i){t.ajax({url:e,data:{term:s.term},dataType:"json",success:function(e){i(e)},error:function(){throw i([]),new Error("Cannot locate JSON at: "+e)}})})}on_input(e){clearTimeout(this.timeout),this.dd_elem.empty().hide(),this.suggestions=[],this.current_focus=-1,this.input_elem.val().length>=this.min_length&&(this.timeout=setTimeout(this.autocomplete,this.delay))}autocomplete(){let e=this.input_elem.val();this.source({term:e},(t=>{for(let i of t)this.dd_elem.show(),this.suggestions.push(new s(this,i,e))}))}on_keydown(e){let t=this.dd_elem.scrollTop();switch(e.key){case"ArrowDown":this.current_focus++,this.add_active(!0);break;case"ArrowUp":this.current_focus--,this.add_active(!1);break;case"Enter":if(e.preventDefault(),this.current_focus>-1){let e=this.suggestions[this.current_focus];e.selected=!0,this.input_elem.val(e.value),this.hide_dropdown(),this.input_elem.trigger("blur")}break;case"Escape":this.hide_dropdown(),this.input_elem.trigger("blur");break;case"Tab":if(this.hide_dropdown(),this.current_focus>-1){let e=this.suggestions[this.current_focus];this.input_elem.val(e.value),this.hide_dropdown(),this.input_elem.trigger("blur")}break;case"PageDown":if(e.preventDefault(),this.dd_elem.scrollTop(t+this.dd_elem.height()),this.current_focus>-1){let e=0;for(let t in this.suggestions){this.suggestions[t].elem.offset().top<this.dd_elem.offset().top&&e++}this.current_focus=e;let t=this.suggestions[e];this.unselect_all(),t.selected=!0}break;case"PageUp":if(e.preventDefault(),this.dd_elem.scrollTop(t-this.dd_elem.height()),this.current_focus>-1){let e=0;for(let t in this.suggestions){this.suggestions[t].elem.offset().top<this.dd_elem.offset().top&&e++}this.current_focus=e;let t=this.suggestions[e];this.unselect_all(),t.selected=!0}}}select_suggestion(e){this.hide_dropdown(),this.input_elem.val(e)}unselect_all(){for(let e of this.suggestions)e.selected=!1}add_active(e){if(0===this.suggestions.length)return;this.unselect_all(),this.current_focus>=this.suggestions.length?this.current_focus=0:this.current_focus<0&&(this.current_focus=this.suggestions.length-1);let t=this.suggestions[this.current_focus];t.selected=!0;let s=this.dd_elem.scrollTop(),i=t.elem.offset().top,o=t.elem.outerHeight(),l=this.dd_elem.offset().top,n=this.dd_elem.outerHeight();e?0===this.current_focus?this.dd_elem.scrollTop(0):i+o>l+n&&this.dd_elem.scrollTop(s+o):this.current_focus>=this.suggestions.length-1?this.dd_elem.scrollTop(o*this.suggestions.length):i<l&&this.dd_elem.scrollTop(s-o)}hide_dropdown(){this.dd_elem.hide()}}t((function(){void 0!==window.ts?ts.ajax.register(i.initialize,!0):void 0!==window.bdajax?bdajax.register(i.initialize,!0):i.initialize()})),e.AutocompleteSuggestion=s,e.AutocompleteWidget=i,Object.defineProperty(e,"__esModule",{value:!0}),void 0===window.yafowil&&(window.yafowil={}),window.yafowil.autocomplete=e}({},jQuery);
//# sourceMappingURL=widget.min.js.map
