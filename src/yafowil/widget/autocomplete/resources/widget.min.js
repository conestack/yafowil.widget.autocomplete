!function(t,s){"use strict";class i{static initialize(t){s("div.yafowil-widget-autocomplete",t).each((function(){let t=s(this);new i(t)}))}constructor(t){this.elem=t,this.input=s("input.autocomplete",this.elem).attr("spellcheck",!1),this.ac_params=s(".autocomplete-params",this.elem),this.ac_source=s(".autocomplete-source",this.elem);let i=this.dd=s("<div />").addClass("autocomplete-dropdown");this.elem.append(i),this.params=[],this.suggestions=[],this.currentFocus=0,this.binder(),this.autocomplete_input=this.autocomplete_input.bind(this),this.input.off("input",this.autocomplete_input).on("input",this.autocomplete_input),this.hide_dropdown=this.hide_dropdown.bind(this),this.show_dropdown=this.show_dropdown.bind(this),this.input.on("focusout",this.hide_dropdown).on("focus",this.show_dropdown),this.keydown=this.keydown.bind(this),this.input.on("keydown",this.keydown)}unload(){this.input.off("input",this.autocomplete_input).off("focusout",this.hide_dropdown).off("focus",this.show_dropdown).off("keydown",this.keydown)}binder(){let t,s,i=this.ac_params.text().split("|"),e=[];for(t=0;t<i.length;t++){let n=i[t].split(","),h=n[1].replace(/^\s+|\s+$/g,"");isNaN(h)||(h=parseInt(h)),"True"===h&&(h=!0),"False"===h&&(h=!1);var o=n[0].replace(/^\s+|\s+$/g,"");"type"===o?s=h:e[o]=h}let n=this.ac_source.text();if(0===n.indexOf("javascript:")){if(n=n.substring(11,n.length),n=n.split("."),!n.length)throw"No source path found.";let s,i=window;for(t in n){if(s=n[t],void 0===i[s])throw"'"+s+"' not found.";i=i[s]}n=i}e.source=n,"local"===s&&(e.source=e.source.split("|")),this.params=e}autocomplete_input(t){this.dd.empty().hide(),this.suggestions=[];let s=this.input.val(),i=this.params.source;if(!s)return!1;this.currentFocus=-1;for(let t=0;t<i.length;t++)i[t].substr(0,s.length).toUpperCase()===s.toUpperCase()&&(this.dd.show(),this.suggestions.push(new e(this,i[t])))}keydown(t){"ArrowDown"===t.key?(this.currentFocus++,this.add_active()):"ArrowUp"===t.key?(this.currentFocus--,this.add_active()):"Enter"===t.key&&(t.preventDefault(),this.currentFocus>-1&&this.suggestions[this.currentFocus].select())}add_active(){for(let t of this.suggestions)t.elem.removeClass("active");this.currentFocus>=this.suggestions.length&&(this.currentFocus=0),this.currentFocus<0&&(this.currentFocus=this.suggestions.length-1),this.suggestions[this.currentFocus].elem.addClass("active")}hide_dropdown(){this.dd.hide()}show_dropdown(){this.autocomplete_input(),0!==this.suggestions.length&&this.dd.show()}}class e{constructor(t,i){this.ac_widget=t,this.elem=s("<div />").addClass("suggestion").val(i),this.selected=s("<strong />").text(i.substr(0,i.length)),this.rest=s("<span />").text(i.substr(i.length)),this.hidden=s('<input type="hidden" />').val(i),this.elem.append(this.selected).append(this.rest),this.ac_widget.dd.append(this.elem).append(this.hidden),this.select=this.select.bind(this)}select(){this.ac_widget.input.val(this.hidden.val()),this.ac_widget.hide_dropdown(),this.ac_widget.input.blur()}}s((function(){void 0!==window.ts?ts.ajax.register(i.initialize,!0):void 0!==window.bdajax?bdajax.register(i.initialize,!0):i.initialize()})),t.AutocompleteWidget=i,t.Suggestion=e,Object.defineProperty(t,"__esModule",{value:!0}),void 0===window.yafowil&&(window.yafowil={}),window.yafowil.autocomplete=t}({},jQuery);
//# sourceMappingURL=widget.min.js.map
