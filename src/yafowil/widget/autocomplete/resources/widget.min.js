!function(t,s){"use strict";class e{static initialize(t){s("div.yafowil-widget-autocomplete",t).each((function(){new e(s(this))}))}constructor(t){this.elem=t,this.input=s("input.autocomplete",this.elem).attr("spellcheck",!1),this.dd=s("<div />").addClass("autocomplete-dropdown"),this.elem.append(this.dd),this.suggestions=[],this.current_focus=0,this.options=this.parse_options(),this.sourcetype=this.options.type,this.source=this.options.source,this.delay=this.options.delay,this.min_length=this.options.minLength,this.input_handle=this.input_handle.bind(this),this.input.off("input",this.input_handle).on("input",this.input_handle),this.hide_dropdown=this.hide_dropdown.bind(this),this.show_dropdown=this.show_dropdown.bind(this),this.input.on("focusout",this.hide_dropdown).on("focus",this.show_dropdown),this.keydown=this.keydown.bind(this),this.input.on("keydown",this.keydown),this.autocomplete=this.autocomplete.bind(this)}unload(){this.input.off("input",this.input_handle).off("focusout",this.hide_dropdown).off("focus",this.show_dropdown).off("keydown",this.keydown);for(let t of this.suggestions)t.unload()}parse_options(){let t=s(".autocomplete-params",this.elem).text().split("|"),e=[];for(let s=0;s<t.length;s++){let i=t[s].split(","),o=i[1].replace(/^\s+|\s+$/g,"");isNaN(o)||(o=parseInt(o)),"True"===o&&(o=!0),"False"===o&&(o=!1),e[i[0].replace(/^\s+|\s+$/g,"")]=o}let i=s(".autocomplete-source",this.elem).text();return 0===i.indexOf("javascript:")?e.source=i.substring(11,i.length).split("."):"local"===e.type?e.source=i.split("|"):"remote"===e.type&&(e.source=i),e}input_handle(t){clearTimeout(this.timeout),this.dd.empty().hide(),this.suggestions=[],this.current_focus=-1,this.input.val().length<this.min_length||(this.timeout=setTimeout(this.autocomplete,this.delay))}autocomplete(){let t=this.source,e=this.input.val();if("remote"===this.sourcetype)s.getJSON(t).done((t=>{for(let s of t)s.substr(0,e.length).toUpperCase()===e.toUpperCase()&&(this.dd.show(),this.suggestions.push(new i(this,s,e)))}));else for(let s=0;s<t.length;s++)this.dd.show(),t[s].substr(0,e.length).toUpperCase()===e.toUpperCase()&&this.suggestions.push(new i(this,t[s],e))}keydown(t){"ArrowDown"===t.key?(this.current_focus++,this.add_active()):"ArrowUp"===t.key?(this.current_focus--,this.add_active()):"Enter"===t.key&&(t.preventDefault(),this.current_focus>-1&&this.suggestions[this.current_focus].select())}add_active(){for(let t of this.suggestions)t.elem.removeClass("active");this.current_focus>=this.suggestions.length&&(this.current_focus=0),this.current_focus<0&&(this.current_focus=this.suggestions.length-1),this.suggestions[this.current_focus].elem.addClass("active")}hide_dropdown(){this.dd.hide()}show_dropdown(){this.input_handle(),0!==this.suggestions.length&&this.dd.show()}}class i{constructor(t,e,i){this.ac_widget=t,this.elem=s("<div />").addClass("suggestion"),this.selected=s("<strong />").text(i.substr(0,i.length)),this.rest=s("<span />").text(e.substr(i.length,e.length)),this.value=e,this.elem.append(this.selected).append(this.rest),this.ac_widget.dd.append(this.elem),this.select=this.select.bind(this),this.elem.off("mousedown",this.select).on("mousedown",this.select)}unload(){this.elem.off("mousedown",this.select)}select(){this.ac_widget.input.val(this.value),this.ac_widget.hide_dropdown(),this.ac_widget.input.blur()}}s((function(){void 0!==window.ts?ts.ajax.register(e.initialize,!0):void 0!==window.bdajax?bdajax.register(e.initialize,!0):e.initialize()})),t.AutocompleteWidget=e,t.Suggestion=i,Object.defineProperty(t,"__esModule",{value:!0}),void 0===window.yafowil&&(window.yafowil={}),window.yafowil.autocomplete=t}({},jQuery);
//# sourceMappingURL=widget.min.js.map
